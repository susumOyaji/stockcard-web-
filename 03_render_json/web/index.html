<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width" />
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="index.css" />
    <title>StockCard</title>
    <style>
        html {
            background-color: rgb(240, 240, 240);
        }
    </style>
</head>

<body>
    <h1>StockCard</h1>
    <div>
        <ul id="todo-container"></ul>
    </div>

    <div id="dey"></div>

    <div class="average_container">
        <div>
            <a href="./img/icon-arow-24dp/1x" ><img class="icon" src="/baseline_trending_up_black_24dp.png"></a>
        </div>
       
       

        <div class="Price-container">
            <label class="dow_circle"></label>
            <label>Dow Price:$&nbsp;</label>
            <label id="dow-container"></label>
            <br>
            <a><span></span>The day before reshio:$&nbsp;</a>
            <label id="dowreshio-container"></label>

            <br>
            <label class="circle"></label>
            <label>Nikkei Price:￥</label>
            <label id="nk-container"> </label>
            <br>
            <a><span></span>The day before reshio:￥</a>
            <a id="nkreshio-container"></a>

        </div>
    </div>

    <div class="market-container">
        <div class="icon">
            <label>ICON</label>
        </div>
        <div class="Price-container">
            <div><span id="Market">Market capitalization</span></div>
            <label class="circle"></label>
            <label id="Market-price">Market price:</label>
            <br>
            <a id="profit"><span></span> profit(Gains):￥</a>
            <label id="invest"><span></span>investment:￥</label>
        </div>

    </div>

    <div class="listview-container">
        <div class="Code-circle">
            <div id="code">ICON</div>
        </div>

        <div class="Market">
            <label id="Name"></label>
            <br>
            <label>Market:</label>
            <label id="ListviewMarket"></label>
            <label><span></span>Benefits:</label>
            <label id="invest1"></label>
            <br>
            <label>Evaluation:</label>
            <label id="Evalu"></label>
        </div>

        <div class="Button-container">
            <input type="button" id="Previous">
        </div>

    </div>
    <div id="target" class="red">ここにclassを追加することでスタイルを変更します</div>



    <script>
        function Re_fetch() {
            // APIからJSONを取得する
            fetch('./api/v1/list')
                .then((response) => response.json())
                .then((stock) => {
                    // id="todo-container"要素を取得する
                    //const todoContainer = document.querySelector('#todo-container');
                    const dowContainer = document.querySelector('#dow-container');
                    const dowreshioContainer = document.querySelector('#dowreshio-container');
                    const nkContainer = document.querySelector('#nk-container');
                    const nkreshioContainer = document.querySelector('#nkreshio-container');

                    const Name = document.querySelector('#Name');
                    const ListviewMarket = document.querySelector('#ListviewMarket');
                    const Previous = document.querySelector('#Previous');


                    const div = document.getElementById('target');

                    // コンテナの中身を全部消す
                    dowContainer.innerHTML = '';
                    nkContainer.innerHTML = '';


                    if (stock[0].Price != stock[0].Reshio) {
                        dowContainer.innerHTML = stock[0].Price;
                        dowreshioContainer.innerHTML = stock[0].Reshio + "&nbsp" + stock[0].Percent;

                        stock[0].Polarity == "+" ? change = "red" : change = "green";
                        document.getElementsByClassName("dow_circle")[0].style.background = change;
                        document.getElementById("dowreshio-container").style.color = change;


                        nkContainer.innerHTML = stock[1].Price;
                        nkreshioContainer.innerHTML = stock[1].Reshio + "&nbsp" + stock[1].Percent;

                        stock[1].Polarity == "+" ? change = "red" : change = "green";
                        document.getElementsByClassName("circle")[0].style.background = change;
                        document.getElementById("nkreshio-container").style.color = change;

                        Name.innerHTML = stock[2].Name;
                        ListviewMarket.innerHTML = stock[2].Price;
                        Previous.value = stock[2].Reshio;

                    }


                    //}
                })
                .catch((error) => {
                    //alert("エラーが発生しました");
                    dowContainer.innerHTML = "エラーが発生しました";
                    console.error(`[FetchAPI] ${error}, ${URL}`);
                });

        };



        //await Re_fetch();
        window.addEventListener('load', async function () {
            await Re_fetch();
            // setIntervalの基本
            // タイマー開始
            setInterval(Re_fetch, 30000);
        });

        document.getElementById("dey").innerHTML = showDay();
        function showDay() {
            var d = new Date();
            let year = d.getFullYear();
            let month = d.getMonth() + 1;
            let day = d.getDate();
            let dayofweek = d.getDay();
            a = year + "/" + month.toString() + "/" + day.toString();
            return a;
        };




    </script>

</body>

</html>