<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width" />
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="index.css" />
    <title>StockCard</title>
    <style>
        html {
            background-color: rgb(240, 240, 240);
        }
    </style>
</head>

<body>
    <canvas id="cv" width="360" height="150"></canvas>
    <div class="stocks_container">
        <h1>StockCard</h1>
        <div id="dey"></div>
    </div>
    <div class="average_container">

        <label class="material-icons">trending_up</label>

        <div class="Price-container">


            <label class="dow_circle"></label>
            <label>Dow Price:$&nbsp;</label>
            <label id="dow-container"></label>
            <br>
            <a><span></span>The day before reshio:$&nbsp;</a>
            <label id="dowreshio-container"></label>

            <br>
            <label class="circle"></label>
            <label>Nikkei Price:￥</label>
            <label id="nk-container"> </label>
            <br>
            <a><span></span>The day before reshio:￥</a>
            <a id="nkreshio-container"></a>

        </div>
    </div>


    <div class="market-container">
        <label class="material-icons">currency_yen</label>
        <div class="marketPrice-container">
            <div><b><span id="Market">Market capitalization</span></b></div>
            <label class="circle"></label>
            <b>Market price:&nbsp;</b>
            <label id="Market-price"></label>
            <br>
            <label>
                <span1></span1>Profit(Gains):￥
            </label>
            <label id="profit"></label>
            <label>
                <span1></span1>Investment:￥
            </label>
            <label id="invest"></label>
        </div>

    </div>

    <div class="listview-container">

        <div class="Code-circle">
            <div id="code"></div>
        </div>

        <div class="Market">
            <label id="Name"></label>
            <br>
            <label>Market:</label>
            <label id="ListviewMarket"></label>
            <label>
                <span1></span1>Benefits:
            </label>
            <label id="benefit"></label>
            <br>
            <label>Evaluation:</label>
            <label id="evalu"></label>

        </div>


        <button id="previous" type="button"></button>


    </div>
    <div id="target" class="red">ここにclassを追加することでスタイルを変更します</div>



    <script>
        //②配列リテラルの例
        var sony = ['6758', 1665, 200];
        function Re_fetch() {
            // APIからJSONを取得する
            fetch('./api/v1/list')
                .then((response) => response.json())
                .then((stock) => {
                    // id="todo-container"要素を取得する
                    //const todoContainer = document.querySelector('#todo-container');
                    const dowContainer = document.querySelector('#dow-container');
                    const dowreshioContainer = document.querySelector('#dowreshio-container');
                    const nkContainer = document.querySelector('#nk-container');
                    const nkreshioContainer = document.querySelector('#nkreshio-container');


                    const div = document.getElementById('target');

                    // コンテナの中身を全部消す
                    dowContainer.innerHTML = '';
                    nkContainer.innerHTML = '';

                    //document.write('<img id="carousel__main" src="/img/icon-en-24dp/2x/yen_black_24dp.png">');

                    if (stock[0].Price != stock[0].Reshio) {
                        dowContainer.innerHTML = stock[0].Price;
                        dowreshioContainer.innerHTML = stock[0].Reshio + "&nbsp" + stock[0].Percent;

                        stock[0].Polarity == "+" ? change = "red" : change = "green";
                        document.getElementsByClassName("dow_circle")[0].style.background = change;
                        document.getElementById("dowreshio-container").style.color = change;


                        nkContainer.innerHTML = stock[1].Price;
                        nkreshioContainer.innerHTML = stock[1].Reshio + "&nbsp" + stock[1].Percent;

                        stock[1].Polarity == "+" ? change = "red" : change = "green";
                        document.getElementsByClassName("circle")[0].style.background = change;
                        document.getElementById("nkreshio-container").style.color = change;



                    }

                    const Name = document.querySelector('#Name');
                    const ListviewMarket = document.querySelector('#ListviewMarket');

                    const Marketprice = document.querySelector('#Market-price');
                    const Profit = document.querySelector('#profit');
                    const Invest = document.querySelector('#invest');
                    const Benefit = document.querySelector('#benefit');
                    const Evalu = document.querySelector('#evalu');
                    const Code = document.querySelector('#code');
                    const Previous = document.querySelector('#previous');


                    var re = stock[2].Price.replace(',', '');//カンマ削除
                    var con = re * sony[2];//時価X持ち株数
                    var con1 = con.toLocaleString();//カンマ表記に戻す
                    Marketprice.innerHTML = con1;//stock[2].Price+"1234";
                    var inv = sony[1] * sony[2];
                    Invest.innerHTML = inv.toLocaleString();
                    Profit.innerHTML = (con - inv).toLocaleString();

                    Benefit.innerHTML = (re - sony[1]).toLocaleString();
                    Evalu.innerHTML = ((re - sony[1]) * sony[2]).toLocaleString();
                    Name.innerHTML = stock[2].Name;
                    ListviewMarket.innerHTML = stock[2].Price;
                    Code.innerHTML = sony[0];
                    Previous.innerHTML = stock[2].Reshio;
                    stock[2].Polarity == "+" ? change = "rgb(255, 0, 0)" : change = "green";

                    //irobako = document.getElementById("previous");
                    //document.getElementById("previous").style.backgroundColor = change;
                    document.getElementById("previous").style.backgroundColor = change;


                    //}
                })
                .catch((error) => {
                    //alert("エラーが発生しました");
                    dowContainer.innerHTML = "エラーが発生しました";
                    console.error(`[FetchAPI] ${error}, ${URL}`);
                });

            /*
        var cvs = document.getElementById("cv");
        var ctx = cvs.getContext("2d");

        ctx.lineWidth = 1;

        ctx.strokeStyle = "green";  //線の色を緑に指定
        ctx.fillStyle = "red";  //塗り潰しの色を赤に指定
        //ctx.strokeRect(40, 40, 200, 100);
        //ctx.fillRect(40, 40, 200, 100);

        ctx.beginPath();     // 1.Pathで描画を開始する
        ctx.arc(37, 37, 13, Math.PI / 7, -Math.PI / 7, false);
        ctx.moveTo(15, 15); // 2.描画する位置を指定する
        ctx.lineTo(30, 250);


        ctx.lineTo(250, 200);

        ctx.lineTo(280, 130);

        ctx.lineTo(250, 80);

        ctx.closePath();//最後の座標と最初の座標とを結ぶためのメソッドです

        ctx.stroke();
        */

            const canvas = document.getElementById('cv');
            const ctx = canvas.getContext('2d');
            ctx.lineWidth = 1;
            ctx.strokeStyle = "white";  //線の色を緑に指定
            ctx.fillStyle = "red";  //塗り潰しの色を赤に指定

            const p0 = { x: 20, y: 20 }
            const p1 = { x: 80, y: 20 }
            const p2 = { x: 80, y: 35 }
            const p3 = { x: 60, y: 35 }
            const p4 = { x: 60, y: 40 }
            const p5 = { x: 20, y: 40 }


            const labelPoint = function (p) {
                const offset = 15;
                ctx.fillText('(' + p.x + ',' + p.y + ')', p.x + offset, p.y + offset);
            }

            ctx.beginPath();
            ctx.moveTo(50, 50);
            ctx.lineTo(300, 50);
            ctx.lineTo(300, 100);
            ctx.lineTo(200, 100);
            ctx.lineTo(200, 300);
            ctx.lineTo(50, 300);
            ctx.closePath();
            ctx.fill();

            labelPoint(p0);
            labelPoint(p1);
            labelPoint(p2);
            // labelPoint(p3);
            //labelPoint(p4);
            //labelPoint(p5);

            ctx.stroke();



        };



        //await Re_fetch();
        window.addEventListener('load', async function () {
            await Re_fetch();
            // setIntervalの基本
            // タイマー開始
            setInterval(Re_fetch, 60000);
        });

        document.getElementById("dey").innerHTML = showDay();
        function showDay() {
            var d = new Date();
            let year = d.getFullYear();
            let month = d.getMonth() + 1;
            let day = d.getDate();
            let dayofweek = d.getDay();
            a = year + "/" + month.toString() + "/" + day.toString();
            return a;
        };




    </script>

</body>

</html>