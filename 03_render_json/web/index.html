<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width" />
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="index.css" />
    <title>StockCard</title>
    <style>
        html {
            background-color: rgb(240, 240, 240);
        }
    </style>
</head>

<body>
    <h1>StockCard</h1>
    <div>
        <ul id="todo-container"></ul>
    </div>

    <div id="dey"></div>

    <div class="average_container">
        <div class="icon">
            <label>ICON</label>
        </div>
        <div class="Price-container">
            <label class="dow_circle"></label>
            <label>Dow Price:$&nbsp;</label>
            <label id="dow-container"></label>
            <br>
            <a><span></span>The day before reshio:$&nbsp;</a>

            <label id="reshio-container"></label>

        </div>
    </div>


    <script>
        function Re_fetch() {
            // APIからJSONを取得する
            fetch('./api/v1/list')
                .then((response) => response.json())
                .then((stock) => {
                    // id="todo-container"要素を取得する
                    const todoContainer = document.querySelector('#todo-container');
                    const dowContainer = document.querySelector('#dow-container');
                    //const nameContainer = document.querySelector('#name-container');
                    //const priceContainer = document.querySelector('#price-container');
                    const reshioContainer = document.querySelector('#reshio-container');
                    //const percentContainer = document.querySelector('#percent-container');
                    //const polarityContainer = document.querySelector('#polarity-container');

                    // コンテナの中身を全部消す
                    todoContainer.innerHTML = '';

                    // JSONの各要素に対して
                    //for (const item of stock) {
                    /*
                    const li = document.createElement('li');          // リスト要素
                    const label = document.createElement('label');    // ラベル
                    const checkbox = document.createElement('input'); // チェックボックス
                    checkbox.type = 'checkbox';
                    checkbox.checked = item.done;                     // 項目がdoneならチェック
                    const text = new Text(item.title);                // 項目名
 
 
                    // ラベルにチェックボックスとテキストを追加する
                    label.appendChild(checkbox);
                    label.appendChild(text);
 
                    // リスト要素に先ほどのラベルを追加する
                    li.appendChild(label);
                    */
                    // TODOリストにリスト要素を追加する
                    //todoContainer.appendChild(li);


                    //nameContainer.innerHTML = stock[1].Name;
                    //priceContainer.innerHTML = stock[1].Price;
                    //reshioContainer.innerHTML = stock[1].Reshio;
                    //percentContainer.innerHTML = stock[1].Percent;
                    //polarityContainer.innerHTML = stock[1].Polarity;



                    dowContainer.innerHTML = stock[0].Price;
                    reshioContainer.innerHTML = stock[0].Reshio + "&nbsp" + stock[0].Percent;

                    stock[0].Polarity == "+" ? change = "red" : change = "green";
                    document.getElementsByClassName("dow_circle")[0].style.background = change;
                    document.getElementById("reshio-container").style.color = change;

                    //}
                })
                .catch((error) => {
                    //alert("エラーが発生しました");
                    dowContainer.innerHTML="エラーが発生しました";
                    console.error(`[FetchAPI] ${error}, ${URL}`);
                });

        };

        Re_fetch();
        window.addEventListener('load', function () {
            //await Re_fetch();
            // setIntervalの基本
            // タイマー開始
            setInterval(Re_fetch, 30000);
        });

        document.getElementById("dey").innerHTML = showDay();
        function showDay() {
            var d = new Date();
            let year = d.getFullYear();
            let month = d.getMonth() + 1;
            let day = d.getDate();
            let dayofweek = d.getDay();
            a = year + "/" + month.toString() + "/" + day.toString();
            return a;
        };




    </script>

</body>

</html>